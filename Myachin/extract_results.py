# –°–∫—Ä–∏–ø—Ç –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∏–∑ notebook
# –ó–∞–ø—É—Å—Ç–∏—Ç–µ —ç—Ç–æ—Ç –∫–æ–¥ –≤ notebook –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö –∞–Ω–∞–ª–∏–∑–æ–≤

import pandas as pd
import numpy as np

print("="*80)
print(" –†–ï–ó–£–õ–¨–¢–ê–¢–´ –î–õ–Ø –°–õ–ê–ô–î–ê - ODDS RATIO ")
print("="*80)

# –ò–∑ —è—á–µ–π–∫–∏ —Å Logistic Regression
print(f"\nüìä ODDS RATIO (–õ–æ–≥–∏—Å—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ–≥—Ä–µ—Å—Å–∏—è):")
print(f"   Odds Ratio: {odds_ratio_mobile:.3f}")
print(f"   –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è: –†–∏—Å–∫ –Ω–µ–≥–∞—Ç–∏–≤–∞ –≤ {odds_ratio_mobile:.2f} —Ä–∞–∑–∞ –≤—ã—à–µ –¥–ª—è –¢-–ú–æ–±–∞–π–ª")
print(f"   Log-Odds: {log_odds_mobile:.3f}")
print(f"   P-value: {p_logit:.5f}")
print(f"   –ó–Ω–∞—á–∏–º–æ—Å—Ç—å: {'‚úÖ –ó–ù–ê–ß–ò–ú–û (p<0.05)' if p_logit < 0.05 else '‚ùå –ù–ï –ó–ù–ê–ß–ò–ú–û'}")

print(f"\nüìà BOOTSTRAP –∞–Ω–∞–ª–∏–∑ (1000 –∏—Ç–µ—Ä–∞—Ü–∏–π):")
print(f"   –°—Ä–µ–¥–Ω–µ–µ OR: {np.mean(boot_mobile):.3f}")
print(f"   95% –î–ò: [{logit_conf[0]:.3f}, {logit_conf[1]:.3f}]")
print(f"   –°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å: {'‚úÖ –£–°–¢–û–ô–ß–ò–í–û (–Ω–∏–∂–Ω—è—è –≥—Ä–∞–Ω–∏—Ü–∞ > 1)' if logit_conf[0] > 1 else '‚ö†Ô∏è –ù–ï–£–°–¢–û–ô–ß–ò–í–û'}")

print("\n" + "="*80)
print(" –†–ï–ó–£–õ–¨–¢–ê–¢–´ –î–õ–Ø –°–õ–ê–ô–î–ê - MANN-WHITNEY U TEST ")
print("="*80)

# –ò–∑ —è—á–µ–π–∫–∏ —Å Mann-Whitney
print(f"\nüìä –¢–ï–°–¢ –ú–ê–ù–ù–ê-–£–ò–¢–ù–ò (—Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–∞–º–∏):\n")
print(results_df[['–ö–æ–Ω–∫—É—Ä–µ–Ω—Ç', 'Mobile –•—É–∂–µ?', 'P-value', '–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –ø—Ä–æ–∏–≥—Ä—ã—à–∞']].to_string(index=False))

significant_worse = results_df[results_df['P-value'] < 0.05]
print(f"\n‚úÖ –¢-–ú–æ–±–∞–π–ª —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏ —Ö—É–∂–µ: {len(significant_worse)} –∏–∑ {len(results_df)} –ø—Ä–æ–¥—É–∫—Ç–æ–≤")

if len(significant_worse) == len(results_df):
    print("üèÜ –í–ï–†–î–ò–ö–¢: –¢-–ú–æ–±–∞–π–ª —Ö—É–∂–µ –í–°–ï–• –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤ (p<0.05 –¥–ª—è –≤—Å–µ—Ö)")

print(f"\nüìä KRUSKAL-WALLIS (–≥–ª–æ–±–∞–ª—å–Ω—ã–π —Ç–µ—Å—Ç):")
print(f"   H-—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: {k_stat:.3f}")
print(f"   P-value: {k_p:.5f}")
print(f"   –í–µ—Ä–¥–∏–∫—Ç: {'‚úÖ –ï—Å—Ç—å –∑–Ω–∞—á–∏–º—ã–µ —Ä–∞–∑–ª–∏—á–∏—è –º–µ–∂–¥—É –ø—Ä–æ–¥—É–∫—Ç–∞–º–∏' if k_p < 0.05 else '‚ùå –†–∞–∑–ª–∏—á–∏–π –Ω–µ—Ç'}")

print("\n" + "="*80)
print(" –†–ï–ó–£–õ–¨–¢–ê–¢–´ –î–õ–Ø –°–õ–ê–ô–î–ê - OLS –†–ï–ì–†–ï–°–°–ò–Ø ")
print("="*80)

print(f"\nüìä OLS (–ª–∏–Ω–µ–π–Ω–∞—è —Ä–µ–≥—Ä–µ—Å—Å–∏—è):")
print(f"   Beta –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç: {beta_mobile:.3f}")
print(f"   –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è: –¢-–ú–æ–±–∞–π–ª —Å–Ω–∏–∂–∞–µ—Ç –æ—Ü–µ–Ω–∫—É –Ω–∞ {abs(beta_mobile):.2f} –±–∞–ª–ª–∞")
print(f"   P-value: {p_ols:.5f}")
print(f"   –ó–Ω–∞—á–∏–º–æ—Å—Ç—å: {'‚úÖ –ó–ù–ê–ß–ò–ú–û (p<0.05)' if p_ols < 0.05 else '‚ùå –ù–ï –ó–ù–ê–ß–ò–ú–û'}")

print(f"\nüìà BOOTSTRAP –∞–Ω–∞–ª–∏–∑ (1000 –∏—Ç–µ—Ä–∞—Ü–∏–π):")
print(f"   –°—Ä–µ–¥–Ω–µ–µ Beta: {np.mean(boot_ols):.3f}")
print(f"   95% –î–ò: [{ols_conf[0]:.3f}, {ols_conf[1]:.3f}]")
print(f"   –°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å: {'‚úÖ –£–°–¢–û–ô–ß–ò–í–û (–≤–µ—Ä—Ö–Ω—è—è –≥—Ä–∞–Ω–∏—Ü–∞ < 0)' if ols_conf[1] < 0 else '‚ö†Ô∏è –ù–ï–£–°–¢–û–ô–ß–ò–í–û'}")

print("\n" + "="*80)
print(" üéØ –î–õ–Ø POWERPOINT - –ö–†–ê–¢–ö–ê–Ø –í–ï–†–°–ò–Ø ")
print("="*80)

print(f"""
–°–õ–ê–ô–î 1: ODDS RATIO
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
‚Ä¢ –†–∏—Å–∫ –Ω–µ–≥–∞—Ç–∏–≤–∞ –¥–ª—è –¢-–ú–æ–±–∞–π–ª: {odds_ratio_mobile:.2f}x –≤—ã—à–µ
‚Ä¢ 95% –¥–æ–≤–µ—Ä–∏—Ç–µ–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª: [{logit_conf[0]:.2f}, {logit_conf[1]:.2f}]
‚Ä¢ P-value: {p_logit:.5f} (–≤—ã—Å–æ–∫–æ–∑–Ω–∞—á–∏–º–æ)
‚Ä¢ Bootstrap (1000 –∏—Ç–µ—Ä–∞—Ü–∏–π): —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Å—Ç–∞–±–∏–ª–µ–Ω

–°–õ–ê–ô–î 2: MANN-WHITNEY U TEST
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
‚Ä¢ –¢-–ú–æ–±–∞–π–ª —Ö—É–∂–µ –í–°–ï–• {len(significant_worse)} –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤ (p<0.05)
‚Ä¢ –°—Ä–µ–¥–Ω—è—è –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –ø—Ä–æ–∏–≥—Ä—ã—à–∞: {results_df['–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –ø—Ä–æ–∏–≥—Ä—ã—à–∞'].str.rstrip('%').astype(float).mean():.1f}%
‚Ä¢ Kruskal-Wallis H-—Ç–µ—Å—Ç: p={k_p:.5f} (–µ—Å—Ç—å —Ä–∞–∑–ª–∏—á–∏—è)

–°–õ–ê–ô–î 3: LINEAR REGRESSION (OLS)
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
‚Ä¢ –°–Ω–∏–∂–µ–Ω–∏–µ –æ—Ü–µ–Ω–∫–∏: {abs(beta_mobile):.2f} –±–∞–ª–ª–∞
‚Ä¢ 95% –¥–æ–≤–µ—Ä–∏—Ç–µ–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª: [{ols_conf[0]:.2f}, {ols_conf[1]:.2f}]
‚Ä¢ P-value: {p_ols:.5f} (–≤—ã—Å–æ–∫–æ–∑–Ω–∞—á–∏–º–æ)
‚Ä¢ Bootstrap (1000 –∏—Ç–µ—Ä–∞—Ü–∏–π): —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Å—Ç–∞–±–∏–ª–µ–Ω

üéØ –ì–õ–ê–í–ù–´–ô –í–´–í–û–î:
–¢-–ú–æ–±–∞–π–ª ‚Äî —Å–∏—Å—Ç–µ–º–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞ —ç–∫–æ—Å–∏—Å—Ç–µ–º—ã.
–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ —Ç—Ä–µ–º—è –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–º–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏–º–∏ –º–µ—Ç–æ–¥–∞–º–∏.
""")

# –°–æ—Ö—Ä–∞–Ω–∏–º –≤ CSV –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞
summary = pd.DataFrame({
    '–ú–µ—Ç–æ–¥': ['Odds Ratio', 'OLS Regression', 'Mann-Whitney U'],
    '–ö–ª—é—á–µ–≤–∞—è –º–µ—Ç—Ä–∏–∫–∞': [
        f'{odds_ratio_mobile:.2f}x —Ä–∏—Å–∫',
        f'{abs(beta_mobile):.2f} –±–∞–ª–ª–∞ —Å–Ω–∏–∂–µ–Ω–∏–µ',
        f'{len(significant_worse)}/{len(results_df)} —Ö—É–∂–µ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤'
    ],
    'P-value': [f'{p_logit:.5f}', f'{p_ols:.5f}', f'–≤—Å–µ <0.05'],
    '95% –î–ò': [
        f'[{logit_conf[0]:.2f}, {logit_conf[1]:.2f}]',
        f'[{ols_conf[0]:.2f}, {ols_conf[1]:.2f}]',
        '—Å–º. —Ç–∞–±–ª–∏—Ü—É'
    ],
    '–í–µ—Ä–¥–∏–∫—Ç': ['‚úÖ –ó–Ω–∞—á–∏–º–æ', '‚úÖ –ó–Ω–∞—á–∏–º–æ', '‚úÖ –ó–Ω–∞—á–∏–º–æ']
})

print("\nüìã –¢–∞–±–ª–∏—Ü–∞ –¥–ª—è —Å–ª–∞–π–¥–∞:")
print(summary.to_string(index=False))

# –°–æ—Ö—Ä–∞–Ω–∏–º
summary.to_csv('—Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã_–¥–ª—è_—Å–ª–∞–π–¥–∞.csv', index=False, encoding='utf-8-sig')
results_df.to_csv('mannwhitney_–¥–µ—Ç–∞–ª—å–Ω–æ.csv', index=False, encoding='utf-8-sig')

print("\n‚úÖ –§–∞–π–ª—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã:")
print("   - —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã_–¥–ª—è_—Å–ª–∞–π–¥–∞.csv (–∫—Ä–∞—Ç–∫–∞—è —Å–≤–æ–¥–∫–∞)")
print("   - mannwhitney_–¥–µ—Ç–∞–ª—å–Ω–æ.csv (–ø–æ–ª–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã Mann-Whitney)")
